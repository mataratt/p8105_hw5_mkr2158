---
title: "Homework 5"
author: Matariya Rattanapan (mkr2158)
output: github_document
---

Loading in key packages and setting design elements.

```{r setup, message=FALSE}
library(tidyverse)

set.seed(1)
n        = 30
sigma    = 5
mu_value = 0:6

knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

```

## Question 1

N/A

## Question 2

Creating the one-sample t-test function.
```{r}
one_ttest_fx = function(mu) {
  
      x = rnorm(n, mean = mu, sd = sigma)
      
      broom::tidy(t.test(x, mu = 0)) |> 
      dplyr::select(estimate, p.value)

}
```

Generate 5,000 datasets using function. Simulated this for mu = 0:6. Rejection of null hypothesis if p-value > α = 0.05.

```{r}
results_df =
  expand_grid(
    mu = mu_value, 
    iter = 1:5000) |>
  mutate(
    test_results = map(mu, one_ttest_fx)
    ) |>
  unnest(test_results) |>
  mutate(
    reject = p.value < 0.05
    )
```

Total number of observations in `results_df` is 35,000. 

Making a plot showing the proportion of times the null was rejected (the power of the test) on the y axis and the true value of μ on the x axis. 

```{r}
power_df =
  results_df |>
  group_by(mu) |>
  summarize(power = mean(reject))

ggplot(power_df, aes(x = mu, y = power)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  labs(
    title = "Power of One-Sample T-Test",
    x = expression(True~mu),
    y = "Power"
  )
```

* From the graph, we see that as the true μ (mean) is closer to 0, the power is closest to a = 0.05 (level of significance 5%).
* As the true μ (mean) increases, power, or the proportion of rejecting the null increases as well. Thus, a large true μ translates to a larger effect size which means the one-sample t-test has greater power, reflecting a positive association between effect size and power. 

Making a plot showing the average estimate of μ on the y axis and the true value of μ the x axis.
The plot also contains an overlay of the average estimate of μ only in samples for which the null was rejected.

```{r}
avg_mu =
  results_df |>
  group_by(mu) |>
  summarize(
    mu_hat = mean(estimate),
    mu_hat_rejected = mean(estimate[reject])
  ) |>
  pivot_longer(
    cols = c(mu_hat, mu_hat_rejected),
    names_to = "mu_hat",
    values_to = "average"
  )

ggplot(avg_mu, aes(x = mu, y = average, color = mu_hat)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  labs(
    title = "Average Estimated μ and Rejected μ y True μ",
    x = expression(True~mu),
    y = expression(Average~hat(mu)),
    color = NULL
  ) +
  scale_color_discrete(
    labels = c("All Samples", "Only When Null Rejected")
  )
```

* The red line represents the average estimated mean of all samples, whereas the blue lines representthe average estimate of mean in samples only when the null is rejected. When the true μ is small, the average mean for samples only when null reject tends to be higher than that of the overall sample mean. Generally however, the sample average of μ across the test for which the null is rejected tends to overestimate (be higher) than the true value of μ since we are looking at only sample for which the null is rejected. 


## Problem 3

Reading in the raw `homicide` dataset.
```{r, message = FALSE}
homicide = 
  read_csv("data/homicide-data.csv")
```

* The raw data contains `r nrow(homicide)` observations and `r ncol(homicide)` variables. 
* The variables for this raw dataset include: `uid`, `reported_date`, `victim_last`, `victim_first`, `victim_race`, `victim_age`, `victim_sex`, `city`, `state`, `lat`, `lon`, and `disposition`.


